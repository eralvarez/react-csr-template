# Copilot Instructions for react-csr-template

This document outlines the architecture, coding standards, and best practices for the react-csr-template project.

## Project Overview

**react-csr-template** is a modern React Client-Side Rendering (CSR) template built with:

- **React 19.2** with React Router 7 for client-side navigation
- **Material-UI (MUI) 7.3** as the exclusive UI component library
- **TypeScript 5.9** with strict mode enabled
- **Vite** for fast development and optimized builds
- **React Compiler** (Babel plugin) for automatic performance optimization
- **Firebase** for authentication and backend services
- **react-hook-form** with Zod validation for form handling
- **Generouted** for file-based routing with auto-generated routes

### Key Dependencies

```json
{
  "react": "^19.2.0",
  "react-dom": "^19.2.0",
  "react-router": "^7.11.0",
  "@generouted/react-router": "^1.20.0",
  "@mui/material": "^7.3.6",
  "@mui/icons-material": "^7.3.6",
  "firebase": "^12.7.0",
  "react-hook-form": "^7.70.0",
  "zod": "^4.3.4"
}
```

## File Structure and Routing

### Directory Layout

```
src/
├── components/          # Reusable MUI-based components (empty - add as needed)
├── hooks/              # Custom React hooks (create as needed)
├── libs/               # External library integrations and utilities
│   ├── firebase.ts     # Firebase configuration and exports
│   └── index.ts        # Barrel export for libs
├── pages/              # File-based routing pages
│   ├── _app.tsx        # Root layout wrapper
│   ├── index.tsx       # Home page
│   ├── about/
│   │   ├── _layout.tsx # Layout for about section
│   │   └── index.tsx   # About page
│   └── app/
│       ├── _layout.tsx # Layout for app section
│       └── index.tsx   # App page
├── assets/             # Static assets (images, fonts, etc.)
├── main.tsx            # Entry point
├── router.ts           # Generated by Generouted (do not edit manually)
└── theme.ts            # MUI theme configuration
```

### File-Based Routing Convention

- Pages are in `src/pages/` directory
- Routes are auto-generated by Generouted based on file structure
- `_app.tsx` is the root layout wrapper (wraps all pages)
- `_layout.tsx` files in subdirectories define section-specific layouts
- `index.tsx` files define the page content
- Routes follow directory structure: `/pages/about/index.tsx` → `/about`

## Component Patterns

### Required: Arrow Functions Only

All React components must be arrow functions. **Never use class components or React.FC.**

```tsx
// ✅ CORRECT
const MyComponent = () => {
  return <Box>Content</Box>;
};

// ✅ ALSO CORRECT
const MyComponent = () => <Box>Content</Box>;

// ❌ WRONG - Do not use React.FC
const MyComponent: React.FC = () => {
  return <Box>Content</Box>;
};

// ❌ WRONG - Do not use class components
class MyComponent extends React.Component {
  render() {
    return <Box>Content</Box>;
  }
}
```

### Props Interface Pattern

Define props as a separate interface named `ComponentNameProps`:

```tsx
interface ButtonProps {
  label: string;
  onClick: () => void;
  disabled?: boolean;
  variant?: 'contained' | 'outlined' | 'text';
}

const Button = ({
  label,
  onClick,
  disabled = false,
  variant = 'contained',
}: ButtonProps) => {
  return (
    <MuiButton variant={variant} disabled={disabled} onClick={onClick}>
      {label}
    </MuiButton>
  );
};

export { Button };
export type { ButtonProps };
```

### Component Exports

Components are exported as named exports along with their types:

```tsx
// components/Button/Button.tsx
export { Button };
export type { ButtonProps };

// components/Button/index.ts
export { Button } from './Button';
export type { ButtonProps } from './Button';

// components/index.ts (barrel export)
export { Button } from './Button';
export type { ButtonProps } from './Button';
```

## Styling Standards

### MUI sx Prop Only

**All styling must use the MUI `sx` prop. No alternative styling methods are permitted.**

- ✅ Use MUI `sx` prop for all styles
- ✅ Use MUI theme values for consistency
- ✅ Use MUI breakpoints for responsive design
- ❌ **No Emotion styled components** (even though @emotion/react is installed)
- ❌ **No CSS modules**
- ❌ **No className strings**
- ❌ **No inline styles** (use sx instead)

### Basic Styling Example

```tsx
const Card = ({ title, children }: CardProps) => {
  return (
    <Box
      sx={{
        padding: 2,
        backgroundColor: '#f5f5f5',
        borderRadius: 1,
        boxShadow: 1,
      }}
    >
      <Typography variant="h6" sx={{ marginBottom: 1 }}>
        {title}
      </Typography>
      {children}
    </Box>
  );
};
```

### Responsive Design with Breakpoints

Use MUI breakpoints in the `sx` prop for responsive design. MUI breakpoints are: `xs`, `sm`, `md`, `lg`, `xl`.

```tsx
const ResponsiveContainer = () => {
  return (
    <Box
      sx={{
        padding: {
          xs: 1, // Extra small devices: padding 4px
          sm: 2, // Small devices and up: padding 8px
          md: 3, // Medium devices and up: padding 12px
          lg: 4, // Large devices and up: padding 16px
        },
        fontSize: {
          xs: '0.875rem',
          md: '1rem',
          lg: '1.125rem',
        },
        display: {
          xs: 'block',
          md: 'flex',
        },
        flexDirection: {
          xs: 'column',
          md: 'row',
        },
      }}
    >
      Responsive content
    </Box>
  );
};
```

### Using Theme Values

Reference theme values from `src/theme.ts` for consistency:

```tsx
import { theme } from 'lib/theme'; // When available, or import in component

const ThemedBox = () => {
  return (
    <Box
      sx={{
        color: theme.palette.primary.main,
        backgroundColor: theme.palette.background.paper,
        borderRadius: theme.shape.borderRadius,
      }}
    >
      Themed content
    </Box>
  );
};
```

## TypeScript Standards

### Strict Mode Enforced

The project uses strict TypeScript with no `any` types allowed:

- ✅ Type all function parameters and return types
- ✅ Use interfaces for object shapes
- ✅ Use union types for variants
- ✅ Enable `noUnusedLocals` and `noUnusedParameters`
- ❌ **No `any` types** (lint rule enforces this)
- ❌ **No implicit `any`**

### Example TypeScript Patterns

```tsx
// Type function parameters and return types
const calculateTotal = (items: CartItem[], taxRate: number): number => {
  return (
    items.reduce((sum, item) => sum + item.price * item.quantity, 0) *
    (1 + taxRate)
  );
};

// Use interfaces for props and data
interface User {
  id: string;
  name: string;
  email: string;
  role: 'admin' | 'user' | 'guest';
}

// Use union types for variants
type ButtonVariant = 'contained' | 'outlined' | 'text';
type ButtonSize = 'small' | 'medium' | 'large';

// Type generic handlers
const handleChange = (event: React.ChangeEvent<HTMLInputElement>): void => {
  // handler logic
};
```

## Code Style Standards

### Import Path Aliases

Use path aliases defined in `vite.config.ts` for clean imports:

```tsx
// ✅ CORRECT - Use aliases
import { Button } from 'components/Button';
import { useCustomHook } from 'hooks/useCustomHook';
import { db, auth } from 'lib/firebase';
import HomePage from 'pages/index';

// ❌ WRONG - Relative paths
import { Button } from '../../../components/Button';
import { useCustomHook } from '../../hooks/useCustomHook';
```

Configured aliases:

- `lib` → `src/lib`
- `components` → `src/components`
- `pages` → `src/pages`
- `hooks` → `src/hooks`

### Prettier Formatting

All code is formatted with Prettier (v3.7.4):

- Run `npm run format` to format all files
- Run `npm run format:check` to check formatting without changes
- Use only `prettier --write .` or `npm run format`

### ESLint Rules

The project enforces comprehensive ESLint rules:

```javascript
// Files checked: **/*.{ts,tsx}
// Extends:
// - @eslint/js recommended
// - typescript-eslint recommended
// - eslint-plugin-react-hooks recommended
// - eslint-plugin-react-refresh (Vite)

// Run: npm run lint
```

Key rules:

- TypeScript strict mode compliance
- React Hooks rules (`useEffect` dependencies, etc.)
- React Refresh for fast refresh
- No unused variables or parameters

## React Patterns and Hooks

### Forms: react-hook-form + Zod

Always use react-hook-form with Zod for validation:

```tsx
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { z } from 'zod';
import { Box, Button, TextField } from '@mui/material';

// Define schema
const signupSchema = z.object({
  email: z.string().email('Invalid email'),
  password: z.string().min(8, 'Password must be 8+ characters'),
  name: z.string().min(1, 'Name required'),
});

type SignupFormData = z.infer<typeof signupSchema>;

const SignupForm = () => {
  const {
    register,
    handleSubmit,
    formState: { errors },
  } = useForm<SignupFormData>({
    resolver: zodResolver(signupSchema),
  });

  const onSubmit = (data: SignupFormData) => {
    console.log('Form data:', data);
  };

  return (
    <Box
      component="form"
      onSubmit={handleSubmit(onSubmit)}
      sx={{ display: 'flex', flexDirection: 'column', gap: 2 }}
    >
      <TextField
        {...register('email')}
        label="Email"
        error={!!errors.email}
        helperText={errors.email?.message}
      />
      <TextField
        {...register('password')}
        type="password"
        label="Password"
        error={!!errors.password}
        helperText={errors.password?.message}
      />
      <TextField
        {...register('name')}
        label="Name"
        error={!!errors.name}
        helperText={errors.name?.message}
      />
      <Button type="submit" variant="contained">
        Sign Up
      </Button>
    </Box>
  );
};

export { SignupForm };
```

### Controlled Components with MUI

When using react-hook-form with MUI components, use **controlled components** with `Controller` for complex MUI components that don't work with standard `register()`:

```tsx
import { useForm, Controller } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { z } from 'zod';
import {
  Box,
  Button,
  TextField,
  Select,
  MenuItem,
  FormControl,
  FormHelperText,
} from '@mui/material';

const formSchema = z.object({
  email: z.string().email('Invalid email'),
  role: z.enum(['admin', 'user', 'guest']),
  bio: z.string().max(500, 'Bio must be 500 characters or less'),
});

type FormData = z.infer<typeof formSchema>;

const AdvancedForm = () => {
  const {
    control,
    handleSubmit,
    formState: { errors },
  } = useForm<FormData>({
    resolver: zodResolver(formSchema),
    defaultValues: {
      email: '',
      role: 'user',
      bio: '',
    },
  });

  const onSubmit = (data: FormData) => {
    console.log('Form data:', data);
  };

  return (
    <Box
      component="form"
      onSubmit={handleSubmit(onSubmit)}
      sx={{ display: 'flex', flexDirection: 'column', gap: 2 }}
    >
      {/* Standard register() works for simple TextField */}
      <Controller
        name="email"
        control={control}
        render={({ field }) => (
          <TextField
            {...field}
            label="Email"
            type="email"
            error={!!errors.email}
            helperText={errors.email?.message}
          />
        )}
      />

      {/* Controller for complex MUI components like Select */}
      <Controller
        name="role"
        control={control}
        render={({ field }) => (
          <FormControl error={!!errors.role} fullWidth>
            <Select {...field} label="Role">
              <MenuItem value="admin">Admin</MenuItem>
              <MenuItem value="user">User</MenuItem>
              <MenuItem value="guest">Guest</MenuItem>
            </Select>
            {errors.role && (
              <FormHelperText>{errors.role.message}</FormHelperText>
            )}
          </FormControl>
        )}
      />

      {/* Controller for textarea MUI TextField */}
      <Controller
        name="bio"
        control={control}
        render={({ field }) => (
          <TextField
            {...field}
            label="Bio"
            multiline
            rows={4}
            error={!!errors.bio}
            helperText={errors.bio?.message}
          />
        )}
      />

      <Button type="submit" variant="contained">
        Submit
      </Button>
    </Box>
  );
};

export { AdvancedForm };
```

**Key Points:**

- Use `register()` for standard `TextField` components
- Use `Controller` for complex MUI components (`Select`, `Checkbox`, `Radio`, `Switch`, etc.)
- Always wrap MUI components with proper error state and `helperText` for validation feedback
- MUI's `error` prop controls visual error state; use `formState.errors` to access validation messages

### Performance: React Compiler Handles Optimization

The project uses React Compiler (Babel plugin) which automatically optimizes component rendering. **Do not manually use `useMemo`, `useCallback`, or `React.memo`** — let the compiler handle it.

```tsx
// ✅ CORRECT - Let React Compiler optimize
const ExpensiveComponent = ({ data }: Props) => {
  const result = complexCalculation(data);
  return <Box>{result}</Box>;
};

// ❌ WRONG - Manual memoization (unnecessary)
const ExpensiveComponent = ({ data }: Props) => {
  const result = useMemo(() => complexCalculation(data), [data]);
  return <Box>{result}</Box>;
};

// ❌ WRONG - Manual callback memoization
const Button = ({ onClick }: Props) => {
  const memoizedClick = useCallback(() => onClick(), [onClick]);
  return <MuiButton onClick={memoizedClick}>Click</MuiButton>;
};
```

### Custom Hooks Pattern

Place custom hooks in `src/hooks/` with descriptive names:

```tsx
// hooks/useAuth.ts
import { useContext } from 'react';
import { AuthContext } from '../contexts/AuthContext';

const useAuth = () => {
  const context = useContext(AuthContext);
  if (!context) {
    throw new Error('useAuth must be used within AuthProvider');
  }
  return context;
};

export { useAuth };
```

## Firebase Integration

Firebase configuration is in `src/libs/firebase.ts`. **Environment variables are required for production:**

```typescript
// src/libs/firebase.ts
import { initializeApp } from 'firebase/app';
import { getAuth } from 'firebase/auth';
import { getFirestore } from 'firebase/firestore';

const firebaseConfig = {
  apiKey: import.meta.env.VITE_FIREBASE_API_KEY,
  authDomain: import.meta.env.VITE_FIREBASE_AUTH_DOMAIN,
  projectId: import.meta.env.VITE_FIREBASE_PROJECT_ID,
  storageBucket: import.meta.env.VITE_FIREBASE_STORAGE_BUCKET,
  messagingSenderId: import.meta.env.VITE_FIREBASE_MESSAGING_SENDER_ID,
  appId: import.meta.env.VITE_FIREBASE_APP_ID,
  measurementId: import.meta.env.VITE_FIREBASE_MEASUREMENT_ID,
};

const app = initializeApp(firebaseConfig);
export const auth = getAuth(app);
export const db = getFirestore(app);
```

### Environment Variables

Create a `.env` file (not in version control) based on `EXAMPLE.env`:

```dotenv
# Firebase configuration (from Firebase Console)
VITE_FIREBASE_API_KEY=your_api_key
VITE_FIREBASE_AUTH_DOMAIN=your_auth_domain
VITE_FIREBASE_PROJECT_ID=your_project_id
VITE_FIREBASE_STORAGE_BUCKET=your_storage_bucket
VITE_FIREBASE_MESSAGING_SENDER_ID=your_sender_id
VITE_FIREBASE_APP_ID=your_app_id
VITE_FIREBASE_MEASUREMENT_ID=your_measurement_id
```

**Important:** All Vite environment variables must be prefixed with `VITE_` to be exposed to the client.

## MUI Components Only

**Use only Material-UI components for UI. No custom styled components or other UI libraries.**

### Common MUI Components

```tsx
// Layout and containers
import { Box, Container, Grid, Stack } from '@mui/material';

// Typography
import { Typography, Heading } from '@mui/material';

// Forms
import { TextField, Button, Checkbox, Radio, Select } from '@mui/material';

// Surfaces
import { Paper, Card, CardContent, CardHeader } from '@mui/material';

// Navigation
import { AppBar, Toolbar, Drawer } from '@mui/material';

// Feedback
import { Alert, Dialog, Snackbar } from '@mui/material';

// Icons (from @mui/icons-material)
import { Home, Settings, Delete } from '@mui/icons-material';

// Don't use: Custom styled components, CSS-in-JS (Emotion styled)
```

### Theme Usage

Reference theme configuration in `src/theme.ts`:

```typescript
import { createTheme } from '@mui/material/styles';

export const theme = createTheme({
  typography: {
    fontFamily: '"Roboto", sans-serif',
  },
  components: {
    MuiButton: {
      styleOverrides: {
        root: {
          textTransform: 'none',
        },
      },
    },
  },
});
```

Customize theme colors, typography, and component defaults in this file.

## Development Workflow

### Scripts

```bash
# Development
npm run dev              # Start dev server on port 3000
npm run develop         # Alias for dev

# Production build
npm run build           # Compile TypeScript and build with Vite
npm run preview         # Preview production build locally

# Code quality
npm run lint            # Run ESLint checks
npm run format          # Format code with Prettier
npm run format:check    # Check formatting without changes

# Production
npm run start           # Serve built dist folder
```

### Pre-commit Checks

Before committing code:

1. **Format code**: `npm run format`
2. **Check linting**: `npm run lint`
3. **Verify types**: `npm run build` (includes TypeScript check)

### Development Tips

- Use React Router's `<Link>` component for navigation
- Generouted auto-generates routes — no manual route configuration needed
- Hot Module Replacement (HMR) works automatically with Vite
- Use React DevTools to inspect components
- Use Firebase Emulator Suite for local testing
- Check `import.meta.env` for environment variables in code

## Layout and Page Structure

### Root Layout (\_app.tsx)

The root layout wraps all pages with ThemeProvider and global setup:

```tsx
// src/pages/_app.tsx
import { Outlet } from 'react-router';
import { ThemeProvider } from '@mui/material/styles';
import CssBaseline from '@mui/material/CssBaseline';
import '@fontsource/roboto/300.css';
import '@fontsource/roboto/400.css';
import '@fontsource/roboto/500.css';
import '@fontsource/roboto/700.css';

import { theme } from '../theme';

export default function App() {
  return (
    <ThemeProvider theme={theme}>
      <CssBaseline />
      <Outlet />
    </ThemeProvider>
  );
}
```

### Section Layouts (\_layout.tsx)

Section-specific layouts wrap page content for that section:

```tsx
// src/pages/app/_layout.tsx
import { Outlet } from 'react-router';
import { Box, AppBar, Toolbar, Typography } from '@mui/material';

const AppLayout = () => {
  return (
    <Box sx={{ display: 'flex', flexDirection: 'column', minHeight: '100vh' }}>
      <AppBar position="static">
        <Toolbar>
          <Typography variant="h6">App</Typography>
        </Toolbar>
      </AppBar>
      <Box sx={{ flex: 1, padding: 2 }}>
        <Outlet />
      </Box>
    </Box>
  );
};

export default AppLayout;
```

### Page Components

Page components are the leaf routes:

```tsx
// src/pages/app/index.tsx
import { Box, Typography } from '@mui/material';

const AppPage = () => {
  return (
    <Box>
      <Typography variant="h4">App Page</Typography>
      <Typography>Welcome to the app section</Typography>
    </Box>
  );
};

export default AppPage;
```

## Performance Considerations

1. **Code Splitting**: Vite automatically code-splits routes and chunks
2. **React Compiler**: Automatic memoization via Babel plugin — no manual optimization needed
3. **Image Optimization**: Use Vite's static asset handling; compress images before adding
4. **Bundle Analysis**: Use `npm run build` and check the dist folder size
5. **Firebase**: Initialize once in `src/libs/firebase.ts` and reuse across the app
6. **lazy() + Suspense**: For large components, consider dynamic imports with React.lazy()

```tsx
import { lazy, Suspense } from 'react';
import { Box, CircularProgress } from '@mui/material';

const HeavyComponent = lazy(() => import('./HeavyComponent'));

const App = () => {
  return (
    <Suspense
      fallback={
        <Box sx={{ display: 'flex', justifyContent: 'center' }}>
          <CircularProgress />
        </Box>
      }
    >
      <HeavyComponent />
    </Suspense>
  );
};
```

## Summary of Key Rules

| Category        | ✅ Do                                | ❌ Don't                                  |
| --------------- | ------------------------------------ | ----------------------------------------- |
| **Components**  | Arrow functions, props interfaces    | React.FC, class components                |
| **Styling**     | MUI sx prop, theme values            | Emotion styled, CSS modules, className    |
| **TypeScript**  | Strict types, interfaces             | `any` types, implicit any                 |
| **Forms**       | react-hook-form + Zod                | Uncontrolled forms, manual validation     |
| **Performance** | Let React Compiler optimize          | useMemo, useCallback, React.memo          |
| **Routing**     | File-based with Generouted           | Manual route config                       |
| **UI**          | MUI components only                  | Custom styled components, other libraries |
| **Imports**     | Path aliases (lib, components, etc.) | Long relative paths                       |
| **Env Vars**    | VITE\_ prefix, .env file             | Hardcoded values, without prefix          |

---

**Last Updated:** January 2025
**React Version:** 19.2.0
**TypeScript Version:** 5.9.3
**MUI Version:** 7.3.6
